# ğŸ›¡ï¸ Malware Sandbox Sistemi - KullanÄ±m Rehberi

## ğŸ“‹ Genel BakÄ±ÅŸ

Dijital Karantina projesine **profesyonel bir Malware Sandbox sistemi** eklendi. Bu sistem, dosyalarÄ± Docker konteynÄ±rÄ± iÃ§inde izole bir ÅŸekilde analiz eder ve hem statik hem de dinamik analiz yapar.

## ğŸ—ï¸ Sistem Mimarisi

### 1. Docker Sandbox AltyapÄ±sÄ±
- **Konum:** `docker/` klasÃ¶rÃ¼
- **Dockerfile:** `Dockerfile.sandbox` - Ä°zole analiz ortamÄ±
- **Docker Compose:** `docker-compose.yml` - KonteynÄ±r yÃ¶netimi
- **Analiz Scripti:** `sandbox_analyzer.py` - Docker iÃ§inde Ã§alÄ±ÅŸan analiz motoru

### 2. Backend Servisleri
- **Statik Analiz:** `backend/services/static_analyzer.py`
  - Hash hesaplama (MD5, SHA1, SHA256, SHA512)
  - String extraction
  - File type detection
  - Entropy analysis
  - PE/ELF file analysis
  
- **Docker Sandbox:** `backend/services/docker_sandbox.py`
  - Docker konteynÄ±rÄ± yÃ¶netimi
  - Dinamik analiz koordinasyonu
  - Network ve file operation monitoring
  
- **Karantina GÃ¼nlÃ¼ÄŸÃ¼:** `backend/services/quarantine_log.py`
  - Analiz sonuÃ§larÄ±nÄ± kaydetme
  - GÃ¼nlÃ¼k kayÄ±tlarÄ±nÄ± yÃ¶netme
  - Arama ve filtreleme

### 3. API Endpoint'leri

#### `/analyze/file` (POST)
Dosya analizi endpoint'i. DosyayÄ± Docker sandbox iÃ§inde analiz eder.

**Request:**
```json
multipart/form-data
file: <dosya>
```

**Response:**
```json
{
  "status": "success",
  "risk_score": 75,
  "risk_level": "high",
  "filename": "suspicious.exe",
  "file_hash": "sha256_hash...",
  "quarantine_id": "abc123...",
  "analysis": {
    "static": { ... },
    "dynamic": { ... },
    "docker_available": true
  },
  "quarantine_log": { ... }
}
```

#### `/quarantine/log` (GET)
Karantina gÃ¼nlÃ¼ÄŸÃ¼ kayÄ±tlarÄ±nÄ± getirir.

**Query Parameters:**
- `limit`: Maksimum kayÄ±t sayÄ±sÄ± (default: 50)
- `filename`: Dosya adÄ±na gÃ¶re filtrele
- `hash`: Hash'e gÃ¶re filtrele
- `risk_level`: Risk seviyesine gÃ¶re filtrele (low/medium/high)

#### `/quarantine/log/{log_id}` (GET)
Belirli bir gÃ¼nlÃ¼k kaydÄ±nÄ± getirir.

#### `/quarantine/log/{log_id}` (DELETE)
GÃ¼nlÃ¼k kaydÄ±nÄ± siler.

## ğŸ”§ Kurulum

### 1. Docker Kurulumu

Docker'Ä±n yÃ¼klÃ¼ olduÄŸundan emin olun:
```bash
docker --version
docker-compose --version
```

### 2. Python Paketleri

Backend klasÃ¶rÃ¼nde:
```bash
pip install -r requirements.txt
```

Yeni eklenen paketler:
- `pefile` - PE dosya analizi
- `yara-python` - YARA kurallarÄ± (opsiyonel)
- `capstone` - Disassembly (opsiyonel)
- `python-magic` - File type detection

### 3. Docker Sandbox Image'ini Build Etme

```bash
cd docker
docker build -t malware_sandbox -f Dockerfile.sandbox .
```

Veya backend'den:
```python
from services.docker_sandbox import DockerSandbox
sandbox = DockerSandbox()
sandbox.build_sandbox_image()
```

## ğŸš€ KullanÄ±m

### Backend'i BaÅŸlatma

```bash
cd backend
python main.py
```

### Frontend'i BaÅŸlatma

```bash
cd frontend
python -m http.server 5500
```

### Dosya Analizi Yapma

1. TarayÄ±cÄ±da `http://localhost:5500` adresini aÃ§Ä±n
2. "Dosya Analizi" kartÄ±nda bir dosya seÃ§in
3. "Analizi BaÅŸlat" butonuna tÄ±klayÄ±n
4. Analiz sonuÃ§larÄ±nÄ± gÃ¶rÃ¼ntÃ¼leyin

## ğŸ“Š Analiz Ã–zellikleri

### Statik Analiz
- âœ… Hash hesaplama (MD5, SHA1, SHA256, SHA512)
- âœ… String extraction (min 4 karakter)
- âœ… File type detection (MIME type, description)
- âœ… Entropy analysis (0-8 arasÄ±)
- âœ… PE file analysis (Windows executables)
  - Entry point
  - Sections
  - Imports/Exports
  - Resources
- âœ… ELF file analysis (Linux executables)

### Dinamik Analiz (Docker Sandbox)
- âœ… DosyayÄ± izole ortamda Ã§alÄ±ÅŸtÄ±rma
- âœ… strace ile system call monitoring
- âœ… Network activity detection
- âœ… File operations tracking
- âœ… Process tree analysis
- âœ… Execution timeout (60 saniye)

### Karantina GÃ¼nlÃ¼ÄŸÃ¼
- âœ… TÃ¼m analiz sonuÃ§larÄ±nÄ± kaydetme
- âœ… Risk skoru ve seviyesi
- âœ… Timestamp ve metadata
- âœ… Arama ve filtreleme

## ğŸ¯ Risk Skoru Hesaplama

Risk skoru 0-100 arasÄ± hesaplanÄ±r:

- **Entropi > 7.5:** +20 puan
- **PE/ELF dosyasÄ±:** +10 puan
- **ÅÃ¼pheli import'lar:** +15 puan
- **Executable dosya tipi:** +30 puan
- **Dinamik analiz (Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±):** +20 puan
- **Network aktivitesi:** +25 puan
- **Ã‡oklu dosya iÅŸlemleri:** +15 puan

**Risk Seviyeleri:**
- **Low (0-39):** DÃ¼ÅŸÃ¼k risk
- **Medium (40-69):** Orta risk
- **High (70-100):** YÃ¼ksek risk

## ğŸ”’ GÃ¼venlik Ã–zellikleri

### Docker Sandbox Ä°zolasyonu
- âœ… Network isolation (`--network none`)
- âœ… Read-only filesystem
- âœ… Memory limit (512MB)
- âœ… CPU limit (1 core)
- âœ… Capability dropping
- âœ… Security options

### Dosya GÃ¼venliÄŸi
- âœ… GeÃ§ici dosyalar otomatik temizlenir
- âœ… Sandbox dizininde sadece okuma izni
- âœ… Analiz sonrasÄ± dosyalar silinir

## ğŸ“ Karantina GÃ¼nlÃ¼ÄŸÃ¼ FormatÄ±

```json
{
  "id": "abc123...",
  "timestamp": "2024-01-01T12:00:00",
  "filename": "suspicious.exe",
  "file_hash": "sha256_hash...",
  "risk_score": 75,
  "risk_level": "high",
  "status": "quarantined",
  "analysis_results": {
    "static_analysis": { ... },
    "dynamic_analysis": { ... }
  }
}
```

## ğŸ› Sorun Giderme

### Docker Mevcut DeÄŸil
- Docker yÃ¼klÃ¼ deÄŸilse, sadece statik analiz yapÄ±lÄ±r
- Dinamik analiz atlanÄ±r
- Frontend'de uyarÄ± gÃ¶sterilir

### Sandbox Build HatasÄ±
```bash
# Docker image'ini yeniden build edin
cd docker
docker build -t malware_sandbox -f Dockerfile.sandbox .
```

### Analiz Timeout
- VarsayÄ±lan timeout: 120 saniye
- Uzun sÃ¼ren analizler iÃ§in timeout artÄ±rÄ±labilir

### Port Ã‡akÄ±ÅŸmasÄ±
- Backend: Port 5050
- Frontend: Port 5500
- FarklÄ± portlar kullanÄ±labilir

## ğŸ“š API Ã–rnekleri

### cURL ile Dosya Analizi

```bash
curl -X POST http://localhost:5050/analyze/file \
  -F "file=@suspicious.exe"
```

### Python ile Dosya Analizi

```python
import requests

with open('suspicious.exe', 'rb') as f:
    response = requests.post(
        'http://localhost:5050/analyze/file',
        files={'file': f}
    )
    print(response.json())
```

### Karantina GÃ¼nlÃ¼ÄŸÃ¼ Sorgulama

```bash
# TÃ¼m kayÄ±tlar
curl http://localhost:5050/quarantine/log?limit=10

# Risk seviyesine gÃ¶re filtrele
curl http://localhost:5050/quarantine/log?risk_level=high

# Hash'e gÃ¶re arama
curl http://localhost:5050/quarantine/log?hash=abc123
```

## ğŸ“ GeliÅŸmiÅŸ Ã–zellikler

### YARA KurallarÄ± (Gelecek)
- YARA kurallarÄ± ile malware imza eÅŸleÅŸtirme
- Ã–zel YARA kurallarÄ± ekleme

### Machine Learning (Gelecek)
- ML tabanlÄ± malware tespiti
- Anomali detection

### Threat Intelligence (Gelecek)
- VirusTotal entegrasyonu
- Hash bazlÄ± tehdit kontrolÃ¼

## ğŸ“ Destek

SorularÄ±nÄ±z iÃ§in:
- GitHub Issues
- DokÃ¼mantasyon: `README.md`
- Test Rehberi: `TEST_REHBERI.md`

---

**âš ï¸ Ã–nemli:** Bu sistem sadece analiz amaÃ§lÄ±dÄ±r. GerÃ§ek zararlÄ± yazÄ±lÄ±mlarÄ± analiz ederken dikkatli olun ve izole bir ortam kullanÄ±n.

